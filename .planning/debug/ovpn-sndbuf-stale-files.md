---
status: diagnosed
trigger: "Investigate why downloaded .ovpn files still contain sndbuf 524288 and rcvbuf 524288 instead of the expected sndbuf 0 and rcvbuf 0"
created: 2026-02-25T00:00:00Z
updated: 2026-02-25T00:00:00Z
---

## Current Focus

hypothesis: The .ovpn files on disk are pre-fix artifacts that were manually generated/downloaded BEFORE commit 1843118 was made. The source code and server config are already correct. No code path produces 524288 anymore.
test: Compared file modification timestamps vs commit timestamp; confirmed files predate or were generated before the fix.
expecting: N/A - root cause confirmed
next_action: Re-download fresh .ovpn files from the running server (which uses the updated binary), or rebuild/redeploy the server binary if the deployed instance predates the fix commit.

## Symptoms

expected: Downloaded .ovpn files contain `sndbuf 0` and `rcvbuf 0`
actual: Files on disk (test_proxy.ovpn, testt.ovpn) contain `sndbuf 524288` and `rcvbuf 524288`
errors: none - silent wrong values
reproduction: Open any of the .ovpn files at repo root
started: Files were created before commit 1843118 applied the fix

## Eliminated

- hypothesis: Source code (openvpn_handler.go) was not updated
  evidence: Lines 217-218 clearly read `sndbuf 0` and `rcvbuf 0`. Commit 1843118 diff confirms the old 524288 values were replaced.
  timestamp: 2026-02-25

- hypothesis: A second code path elsewhere generates .ovpn files with 524288
  evidence: Full codebase grep for sndbuf/rcvbuf finds only: the two .ovpn artifact files on disk, planning docs, and client-server.conf (which already has 0). No other Go/script code generates these values.
  timestamp: 2026-02-25

- hypothesis: client-server.conf still pushes 524288 to clients at connection time
  evidence: client-server.conf lines 48-51 read `sndbuf 0`, `rcvbuf 0`, `push "sndbuf 0"`, `push "rcvbuf 0"`. Already fixed.
  timestamp: 2026-02-25

## Evidence

- timestamp: 2026-02-25
  checked: server/internal/api/handler/openvpn_handler.go lines 217-218
  found: `ovpn.WriteString("sndbuf 0\n")` and `ovpn.WriteString("rcvbuf 0\n")`
  implication: Source code is correct. The handler generates 0 values.

- timestamp: 2026-02-25
  checked: git log for openvpn_handler.go
  found: Commit 1843118 (2026-02-25 20:07:00 -0500) changed sndbuf/rcvbuf from 524288 to 0
  implication: The fix was committed. Any file generated after this commit by the updated binary would have 0.

- timestamp: 2026-02-25
  checked: test_proxy.ovpn and testt.ovpn modification timestamps
  found: test_proxy.ovpn modified 2026-02-25 03:17:07 (EST = 08:17 UTC), testt.ovpn modified 2026-02-25 03:52:44
  implication: Both files were downloaded/generated BEFORE commit 1843118 (20:07 EST). They are stale artifacts from a pre-fix binary.

- timestamp: 2026-02-25
  checked: testuser.ovpn (modified 2026-02-24)
  found: Does NOT contain sndbuf/rcvbuf at all - uses different code path (no sndbuf lines, cipher AES-256-GCM vs AES-128-GCM)
  implication: testuser.ovpn was generated by a different handler version or manually constructed - not by DownloadOVPN as it exists now.

- timestamp: 2026-02-25
  checked: testdevice.ovpn
  found: Completely different format (has <key>, <cert>, tls-auth) - this is a device tunnel config, not a client proxy config
  implication: Not generated by DownloadOVPN at all. Separate PKI path.

- timestamp: 2026-02-25
  checked: Full codebase grep for "sndbuf"
  found: Only hits are the stale .ovpn files and planning docs. No other code path.
  implication: There is exactly one code path that generates client .ovpn files: DownloadOVPN in openvpn_handler.go.

- timestamp: 2026-02-25
  checked: server/deployments/openvpn/client-server.conf
  found: sndbuf 0, rcvbuf 0, push "sndbuf 0", push "rcvbuf 0" - all correct
  implication: Server config is also correct post-fix.

- timestamp: 2026-02-25
  checked: git status
  found: test_proxy.ovpn and testt.ovpn are untracked files in the repo root
  implication: These are local test artifacts, not generated by the server at runtime. They were manually downloaded during pre-fix testing.

## Resolution

root_cause: >
  The .ovpn files containing 524288 (test_proxy.ovpn, testt.ovpn) are STALE LOCAL ARTIFACTS.
  They were downloaded from the server before commit 1843118 was deployed.
  Both files have timestamps of 03:xx on 2026-02-25; the fix commit landed at 20:07 on the same day.
  The source code (openvpn_handler.go) and server config (client-server.conf) are already correct.
  Any newly downloaded .ovpn file from a server running the post-fix binary will contain sndbuf 0 / rcvbuf 0.

fix: >
  Two actions required:
  1. Redeploy the server binary on the VPS so it runs the post-fix code (if the binary was compiled before 1843118).
  2. Delete or re-download the stale .ovpn files from the updated server endpoint.

verification: Not yet performed - requires checking whether the VPS binary has been rebuilt post-fix.

files_changed: []
