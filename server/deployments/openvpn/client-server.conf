# OpenVPN Client Server Configuration
# This is the OpenVPN instance that end-user clients connect to
# (separate from the device VPN on port 1194)
port 1195
proto udp
dev tun1

# Certificates (generated by ovpn_initpki — named after server IP)
ca /etc/openvpn/pki/ca.crt
cert /etc/openvpn/pki/issued/178.156.210.156.crt
key /etc/openvpn/pki/private/178.156.210.156.key
dh /etc/openvpn/pki/dh.pem

# Client VPN subnet
server 10.9.0.0 255.255.255.0
topology subnet

# No client certificates — authenticate by username/password only
verify-client-cert none
username-as-common-name

# Auth script (validates against API)
script-security 3
auth-user-pass-verify /etc/openvpn/custom/auth-verify.sh via-env

# Connect/disconnect hooks
client-connect /etc/openvpn/custom/client-connect-ovpn.sh
client-disconnect /etc/openvpn/custom/client-disconnect-ovpn.sh

# Push all traffic through VPN
push "redirect-gateway def1 bypass-dhcp"
push "dhcp-option DNS 8.8.8.8"
push "dhcp-option DNS 8.8.4.4"

# Keep connections alive
keepalive 10 120

# Security — use AES-128-GCM for better throughput (still strong, ~2x faster than AES-256)
cipher AES-128-GCM
ncp-ciphers AES-128-GCM
auth SHA256
tls-version-min 1.2

# TLS auth (optional, generated during setup)
# tls-auth /etc/openvpn/pki/ta.key 0

# Performance tuning
sndbuf 0
rcvbuf 0
push "sndbuf 0"
push "rcvbuf 0"
tun-mtu 1500
mssfix 1400
txqueuelen 1000
fast-io  # skip poll/select before UDP write (5-10% CPU reduction, UDP only)

# Persistence
persist-key
persist-tun

# Management interface
management /tmp/openvpn-mgmt.sock unix

# Logging (use /tmp for writable log directory inside container)
status /tmp/openvpn-client-status.log
log-append /tmp/openvpn-client.log
verb 3
