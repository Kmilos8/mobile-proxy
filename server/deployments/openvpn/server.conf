# OpenVPN Server Configuration for Mobile Proxy System
port 1194
proto udp
dev tun

# Certificates (generated during setup)
ca /etc/openvpn/pki/ca.crt
cert /etc/openvpn/pki/issued/server.crt
key /etc/openvpn/pki/private/server.key
dh /etc/openvpn/pki/dh.pem

# Network
server 10.8.0.0 255.255.255.0
topology subnet

# CRITICAL: Do NOT push redirect-gateway
# Only VPN subnet traffic traverses the tunnel
# Proxy traffic on Android devices exits through cellular

# Client-specific configs (static IP assignment)
client-config-dir /etc/openvpn/ccd

# Allow client-to-client (not needed but doesn't hurt)
client-to-client

# Keep connections alive
keepalive 10 120

# Security
cipher AES-256-GCM
auth SHA256
tls-version-min 1.2

# Persistence
persist-key
persist-tun

# Logging
status /var/log/openvpn/status.log
log-append /var/log/openvpn/openvpn.log
verb 3

# Scripts for connect/disconnect notifications
# These call the API to set up/tear down iptables rules
script-security 2
client-connect /etc/openvpn/custom/client-connect.sh
client-disconnect /etc/openvpn/custom/client-disconnect.sh
